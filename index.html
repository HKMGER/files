<!DOCTYPE html>
<!-- saved from url=(0073)https://baque2005.github.io/public-files/files/1770515861577_galaxia.html -->
<html lang="es" crxemulator=""><viinyx-selection-toolbar style="overflow: initial; opacity: 1;"><template shadowrootmode="closed"><link rel="stylesheet" href="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/style.css"><style></style><div></div><div class="wrapper visibility will-change-transform flex items-center bg-white text-black shadow-md ring-1 ring-neutral-200 absolute h-12 select-none rounded-full p-2"><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><img draggable="false" src="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/assets/logo.png" class="block w-6 h-6 pointer-events-none rounded-full shrink-0 select-none"></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><span><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 256 256" stroke-width="0" fill="currentColor" stroke="currentColor"><path d="M48,64a8,8,0,0,1,8-8H72V40a8,8,0,0,1,16,0V56h16a8,8,0,0,1,0,16H88V88a8,8,0,0,1-16,0V72H56A8,8,0,0,1,48,64ZM184,192h-8v-8a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0v-8h8a8,8,0,0,0,0-16Zm56-48H224V128a8,8,0,0,0-16,0v16H192a8,8,0,0,0,0,16h16v16a8,8,0,0,0,16,0V160h16a8,8,0,0,0,0-16ZM219.31,80,80,219.31a16,16,0,0,1-22.62,0L36.68,198.63a16,16,0,0,1,0-22.63L176,36.69a16,16,0,0,1,22.63,0l20.68,20.68A16,16,0,0,1,219.31,80Zm-54.63,32L144,91.31l-96,96L68.68,208ZM208,68.69,187.31,48l-32,32L176,100.69Z"></path></svg></span></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><span><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 576 512" stroke-width="0" fill="currentColor" stroke="currentColor"><path d="M272 256h91.36c43.2 0 82-32.2 84.51-75.34a79.82 79.82 0 0 0-25.26-63.07 79.81 79.81 0 0 0 9.06-44.91C427.9 30.57 389.3 0 347 0h-75a16 16 0 0 0-16 16v224a16 16 0 0 0 16 16zm40-200h40a24 24 0 0 1 0 48h-40zm0 96h56a24 24 0 0 1 0 48h-56zM155.12 22.25A32 32 0 0 0 124.64 0H99.36a32 32 0 0 0-30.48 22.25L.59 235.73A16 16 0 0 0 16 256h24.93a16 16 0 0 0 15.42-11.73L68.29 208h87.42l11.94 36.27A16 16 0 0 0 183.07 256H208a16 16 0 0 0 15.42-20.27zM89.37 144L112 75.3l22.63 68.7zm482 132.48l-45.21-45.3a15.88 15.88 0 0 0-22.59 0l-151.5 151.5-55.41-55.5a15.88 15.88 0 0 0-22.59 0l-45.3 45.3a16 16 0 0 0 0 22.59l112 112.21a15.89 15.89 0 0 0 22.6 0l208-208.21a16 16 0 0 0-.02-22.59z"></path></svg></span></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><span><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 16 16" stroke-width="0" fill="currentColor" stroke="currentColor"><path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"></path><path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"></path></svg></span></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><span><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 640 512" stroke-width="0" fill="currentColor" stroke="currentColor"><path d="M208 352c-2.39 0-4.78.35-7.06 1.09C187.98 357.3 174.35 360 160 360c-14.35 0-27.98-2.7-40.95-6.91-2.28-.74-4.66-1.09-7.05-1.09C49.94 352-.33 402.48 0 464.62.14 490.88 21.73 512 48 512h224c26.27 0 47.86-21.12 48-47.38.33-62.14-49.94-112.62-112-112.62zm-48-32c53.02 0 96-42.98 96-96s-42.98-96-96-96-96 42.98-96 96 42.98 96 96 96zM592 0H208c-26.47 0-48 22.25-48 49.59V96c23.42 0 45.1 6.78 64 17.8V64h352v288h-64v-64H384v64h-76.24c19.1 16.69 33.12 38.73 39.69 64H592c26.47 0 48-22.25 48-49.59V49.59C640 22.25 618.47 0 592 0z"></path></svg></span></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors"><span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="15" width="15" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg></span></button><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors peer/close"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" class="text-shade-600" height="16px" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M20 14a2 2 0 1 1-.001-3.999A2 2 0 0 1 20 14ZM6 12a2 2 0 1 1-3.999.001A2 2 0 0 1 6 12Zm8 0a2 2 0 1 1-3.999.001A2 2 0 0 1 14 12Z"></path></svg></button><div class="!w-0 h-btn hover:!w-btn peer-hover/close:!w-btn transition-[width] overflow-hidden group"><button class="w-btn h-btn rounded-full center-inline-flex hover:bg-zinc-200/80 dark:hover:bg-slate-400/60 active:bg-zinc-300 dark:active:bg-slate-400/80 transition-colors peer/menu"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" class="text-shade-600" height="16px" width="16px" xmlns="http://www.w3.org/2000/svg"><path d="M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z" fill="currentColor"></path></svg></button><div class="absolute top-[calc(100%-5px)] right-0 pt-4 overflow-hidden h-0 hover:h-[150px] peer-hover/menu:h-[150px] pointer-events-none group-hover:pointer-events-auto"><ul class="p-2 bg-white rounded-xl border border-shade-50"><li class="whitespace-nowrap hover:bg-neutral-100"><button class="w-full h-full px-5 py-1 text-left">Hide until next visit</button></li><li class="whitespace-nowrap hover:bg-neutral-100"><button class="w-full h-full px-5 py-1 text-left">Hide for this page</button></li><li class="whitespace-nowrap hover:bg-neutral-100"><button class="w-full h-full px-5 py-1 text-left">Hide for entire site</button></li><li class="whitespace-nowrap hover:bg-neutral-100"><button class="w-full h-full px-5 py-1 text-left">Hide globally</button></li><li class="whitespace-nowrap hover:bg-neutral-100"><button class="w-full h-full px-5 py-1 text-left">Settings</button></li></ul></div></div></div></template></viinyx-selection-toolbar><viinyx-chatbox style="overflow: initial; opacity: 1;"><template shadowrootmode="closed"><link rel="stylesheet" href="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/style.css"><style></style><div class=""></div><div></div><div class="Toastify"></div></template></viinyx-chatbox><viinyx-qa-buttons style="overflow: initial; opacity: 1;"><template shadowrootmode="closed"><link rel="stylesheet" href="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/style.css"><style></style><div></div><div class="fixed right-0 visibility will-change-transform w-[34px] h-[34px] text-black select-none flex flex-col items-center react-draggable" style="transform: translate(0px, 221.6px);"><div class="handle shrink-0 transition-[padding-right]"><button class="w-[36px] h-[36px] bg-white rounded-full center-inline-flex shadow-[0px_0px_0.5px_rgba(0,0,0,0.5),0px_2px_4px_rgba(0,0,0,0.1),0px_4px_10px_rgba(0,0,0,0.1)] hover:shadow-md relative hover:bg-indigo-50 transition-colors"><img draggable="false" src="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/assets/logo.png" class="block w-8 h-8 pointer-events-none rounded-full shrink-0 select-none"></button></div></div></template></viinyx-qa-buttons><viinyx-prompt-menu tabindex="0" style="overflow: initial; opacity: 1;"><template shadowrootmode="closed"><link rel="stylesheet" href="chrome-extension://ochleehcckobncbecepoccjhpjfgepae/style.css"><style></style><div class="" style="max-height: 320px;"></div></template></viinyx-prompt-menu><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia para mi amolchito hemocha</title>
  <meta name="description" content="Galaxia interactiva para mi cari√±o üíò">
  <meta property="og:title" content="Galaxia para ti mi vida">
  <meta property="og:description" content="Una galaxia interactiva para mi amolchitoüíñ">
  <meta property="og:image" content="og-cover.png">
  <link rel="icon" type="image/png" href="https://baque2005.github.io/public-files/files/favicon.png">
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none}
    .attribution{position:fixed;left:10px;bottom:10px;font-size:11px;color:#b9a0ff;opacity:.8;background:rgba(0,0,0,.35);padding:6px 8px;border-radius:8px}
    .player{position:fixed;left:10px;right:10px;bottom:10px;display:flex;gap:8px;align-items:center;
             background:rgba(20,15,35,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px;
             backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);color:#fff;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .player button{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff}
    .player input[type=file]{display:none}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
  </style>
  <!-- Three.js legacy non-module build + OrbitControls (r128, super estable) -->
  <script src="./Galaxia para ti_files/three.min.js.descarga"></script><script type="text/javascript" src="./Galaxia para ti_files/c8d3a069-77c7-41b6-927e-06a4c17fac35" data-awssuidacr="3e45da72-9534-42ae-9dc5-f8c92ff3b9f9"></script>
  <script src="./Galaxia para ti_files/OrbitControls.js.descarga"></script>
<style>:is([id*='google_ads_iframe'],[id*='taboola-'],.taboolaHeight,.taboola-placeholder,#top-ad,#credential_picker_container,#credentials-picker-container,#credential_picker_iframe,[id*='google-one-tap-iframe'],#google-one-tap-popup-container,.google-one-tap__module,.google-one-tap-modal-div,#amp_floatingAdDiv,#ez-content-blocker-container) {display:none!important;min-height:0!important;height:0!important;}</style><script type="text/javascript" src="./Galaxia para ti_files/986df696-a484-42dc-a3ed-0466520e31dc"></script></head>
<body>
<canvas id="galaxy-canvas" width="1908" height="831" style="width: 1272px; height: 554px;"></canvas>
<div class="pill">Te Amo Muchote Mi reinita üòäüëë</div>
<div class="attribution">Base: tlanex ¬∑ Adaptaci√≥n HTML </div>
<div id="err" class="error"></div>

<div class="player">
  <button id="playBtn">‚ñ∂Ô∏é</button>
  <span style="font-size:12px;opacity:.9">Elije tu cancion  <b>cancion.mp3</b>.<b>üíôüåπ‚ô•Ô∏è</b> (Reproductor Mp3‚Äù)</span>
  <input type="file" id="pickFile" accept="audio/*">
  <button id="pickBtn">Elegir canci√≥n</button>
  <audio id="audio" preload="none">
    <source src="ahi_estabas_tu.mp3" type="audio/mpeg">
  </audio>
</div>

<canvas id="fx" style="position: fixed; inset: 0px; pointer-events: none; width: 1272px; height: 554px;" width="1908" height="831"></canvas>

<script>
(function(){
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }

// ====== AUDIO ======
const audio = document.getElementById('audio');
const playBtn = document.getElementById('playBtn');
const pickBtn = document.getElementById('pickBtn');
const pickFile = document.getElementById('pickFile');

playBtn.onclick = async () => {
  try { if (audio.paused) { await audio.play(); playBtn.textContent='‚è∏Ô∏é'; } else { audio.pause(); playBtn.textContent='‚ñ∂Ô∏é'; } }
  catch(e){ showError('Si no suena, toca ‚ÄúElegir canci√≥n‚Äù y selecciona tu MP3.'); }
};
pickBtn.onclick = () => pickFile.click();
pickFile.onchange = () => {
  if (pickFile.files && pickFile.files[0]) {
    const url = URL.createObjectURL(pickFile.files[0]);
    audio.src = url; audio.play().then(()=> playBtn.textContent='‚è∏Ô∏é').catch(()=>{});
  }
};

// ====== WEBGL CHECK ======
try { 
  const test = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
  if(!test) throw new Error('Tu navegador no tiene WebGL activo');
} catch(e) { showError('WebGL parece desactivado. Prueba con Chrome/Edge/Firefox, o habilita aceleraci√≥n por hardware.'); return; }

// ====== THREE.JS GALAXY ======
try {
// Setup
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.minDistance = 10; controls.maxDistance = 220;
controls.target.set(0,0,0);

// Camera default
function setCam(){
  const w = window.innerWidth, h = window.innerHeight;
  const isMobile = w < 768 || w < h;
  camera.fov = isMobile ? 90 : 75;
  camera.position.set(0, isMobile? 26 : 22, isMobile? 110 : 75);
  camera.updateProjectionMatrix(); controls.update();
} setCam();

// ---------- Prettier starfield texture (soft glow + variety) ----------
function makePrettyStarTexture(size=1024, count=2000) {
  const c = document.createElement('canvas'); c.width = c.height = size;
  const g = c.getContext('2d');
  // subtle nebula backdrop (very dark purple radial)
  const r = size/2;
  const bg = g.createRadialGradient(r,r, r*0.2, r,r, r);
  bg.addColorStop(0,'#050010');
  bg.addColorStop(1,'#000000');
  g.fillStyle = bg; g.fillRect(0,0,size,size);

  for (let i=0;i<count;i++) {
    const x = Math.random()*size, y = Math.random()*size;
    const base = Math.random()*0.7 + 0.3; // brightness
    const glow = g.createRadialGradient(x,y,0, x,y, Math.random()*2.2+1.6);
    // color tilt towards lilac/blue
    const huePick = Math.random();
    let colInner = 'rgba(255,255,255,'+(0.65*base)+')';
    let colOuter = 'rgba(180,190,255,'+(0.12*base)+')';
    if (huePick < 0.25) { colOuter = 'rgba(255,180,240,'+(0.12*base)+')'; }
    glow.addColorStop(0, colInner);
    glow.addColorStop(1, colOuter);
    g.fillStyle = glow; g.beginPath(); g.arc(x,y, Math.random()*1.2+0.6, 0, Math.PI*2); g.fill();
  }
  return new THREE.CanvasTexture(c);
}

const bgGeo = new THREE.SphereGeometry(600, 64, 64);
const starTex = makePrettyStarTexture(1024, 2600);
starTex.wrapS = starTex.wrapT = THREE.RepeatWrapping;
const bg = new THREE.Mesh(bgGeo, new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide, transparent:false, opacity:0.85 }));
scene.add(bg);

// Galaxy
const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Pinchecha ‚ú®", " Hermosa üíõ", "Mi veve", "Mi Cielito üåå", "Hermosota ‚ú®", "Mi Infinita ‚ôæÔ∏è", "Mi Todo", "Me Encantas ü•∞", " Eres como un zafiro üòä‚ù§Ô∏è", "Te Amoüíó", "Mi Canci√≥n Favorita üé∂", "Unica üòä", "Mi Reina üëë", "Mi Amor", "Mi Mundo", "Mi Luz üå†", "Mi Ni√±a", "Mi Tesoroüíó", "Mi lugar seguro", "Mi esposhita", "Mi Sue√±o", "Mi Pensamiento Favorito", "Mi Bombom", "Mi Diosa", "Te Amo Infinitamente ‚ôæÔ∏è"];
const phraseCount = Math.max(phrases.length * 6, 180);
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text, size=48){
  const c=document.createElement('canvas'); c.width=1024; c.height=128;
  const g=c.getContext('2d'); g.clearRect(0,0,c.width,c.height);
  g.font='800 '+size+'px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';
  g.textAlign='center'; g.textBaseline='middle';
  g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur=24;
  g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,c.width/2,c.height/2);
  return new THREE.CanvasTexture(c);
}

for(let i=0;i<phraseCount;i++){ const text = phrases[i%phrases.length];
  const tex=makeTextTexture(text,48);
  const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
  spr.isPhrase=true;
  const perArm=phraseCount/arms; const ang=(i%perArm)*(Math.PI*2/perArm);
  const armAng=Math.floor(i/perArm)*(Math.PI*2/arms);
  const dist=Math.pow(i/phraseCount,0.72)*radius;
  const thickness=Math.pow(1-(dist/radius),2);
  const x=Math.cos(ang+armAng)*dist, z=Math.sin(ang+armAng)*dist, y=(Math.random()-0.5)*maxH*thickness*.9;
  spr.position.set(x,y,z); spr.scale.set(20,2.6,1); galaxy.add(spr);
}

// Galaxy stars (keep subtle)
const starCount=8000, geom=new THREE.BufferGeometry(), pos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){ const ang=Math.random()*Math.PI*2, dist=Math.random()*radius*1.15;
  const y=(Math.random()-0.5)*36*Math.pow(1-Math.min(dist,radius)/radius,1.5);
  pos[i*3]=Math.cos(ang)*dist; pos[i*3+1]=y; pos[i*3+2]=Math.sin(ang)*dist; }
geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
galaxy.add(new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending })));

// Black hole (3D core + ring + extended brighter halo)
const coreR=12;
const coreTexCanvas=document.createElement('canvas'); coreTexCanvas.width=coreTexCanvas.height=256;
const cg=coreTexCanvas.getContext('2d'); const grd=cg.createRadialGradient(128,128,10,128,128,128);
grd.addColorStop(0,'#140018'); grd.addColorStop(0.6,'#090012'); grd.addColorStop(1,'#000'); cg.fillStyle=grd; cg.arc(128,128,128,0,Math.PI*2); cg.fill();
const core=new THREE.Mesh(new THREE.SphereGeometry(coreR,64,64), new THREE.MeshBasicMaterial({ map:new THREE.CanvasTexture(coreTexCanvas) }));
core.renderOrder=1; scene.add(core);

const photonRing=new THREE.Mesh(new THREE.RingGeometry(coreR*1.05, coreR*1.18, 128), new THREE.MeshBasicMaterial({ color:0xEAAEFF, transparent:true, opacity:0.95, side:THREE.DoubleSide }));
photonRing.rotation.x=-Math.PI/2; photonRing.renderOrder=0.5; scene.add(photonRing);

function makeHaloTexture(size=1024, inner=0.45){
  const c=document.createElement('canvas'); c.width=c.height=size; const g=c.getContext('2d'); const r=size/2;
  const grd=g.createRadialGradient(r,r,r*inner, r,r,r);
  // brighter, clearer colors
  grd.addColorStop(0.0,'rgba(255,200,240,0.45)');
  grd.addColorStop(0.35,'rgba(220,180,255,0.35)');
  grd.addColorStop(0.7,'rgba(160,200,255,0.28)');
  grd.addColorStop(1,'rgba(0,0,0,0)');
  g.fillStyle=grd; g.fillRect(0,0,size,size); const tex=new THREE.CanvasTexture(c); tex.needsUpdate=true; return tex;
}
const haloPlane=new THREE.Mesh(new THREE.PlaneGeometry(320,320), new THREE.MeshBasicMaterial({ map:makeHaloTexture(1024,0.45), transparent:true, depthWrite:false, blending:THREE.AdditiveBlending, opacity:0.9 }));
haloPlane.rotation.x=-Math.PI/2; haloPlane.renderOrder=0.2; scene.add(haloPlane);

// Subtle twinkle (animate bg texture offset)
let tw = 0;
function animate(){
  requestAnimationFrame(animate);
  const t = performance.now()*0.001;
  tw = (tw + 0.0003) % 1;
  starTex.offset.set(tw, 0); // tiny drift
  galaxy.rotation.y = t * 0.05;
  core.rotation.y = t * 0.12;
  photonRing.rotation.z = t * 0.18;
  haloPlane.rotation.z = t * 0.02;
  controls.update();
  renderer.render(scene, camera);
} animate();

// ====== HEARTS OVERLAY (double tap/click) ======
const fx = document.getElementById('fx');
const ctx2 = fx.getContext('2d');
function resizeFx(){
  fx.width = Math.floor(innerWidth * Math.min(2, window.devicePixelRatio||1));
  fx.height = Math.floor(innerHeight * Math.min(2, window.devicePixelRatio||1));
  fx.style.width = innerWidth + 'px';
  fx.style.height = innerHeight + 'px';
}
addEventListener('resize', resizeFx); resizeFx();
const DPR = Math.min(2, window.devicePixelRatio || 1);
const hearts = [];
function spawnHearts(x,y,n=20){
  x *= DPR; y *= DPR;
  for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2;
    hearts.push({x,y,vx:Math.cos(a)*(0.6+Math.random()*0.8),vy:-(0.8+Math.random()*1.2),life:1,size:10+Math.random()*16});
  }
}
function drawHeart(x,y,size){
  const s=size; ctx2.save(); ctx2.translate(x,y);
  ctx2.beginPath(); ctx2.moveTo(0,-0.25*s);
  ctx2.bezierCurveTo(.5*s,-.9*s,1.4*s,-.1*s,0,.9*s);
  ctx2.bezierCurveTo(-1.4*s,-.1*s,-.5*s,-.9*s,0,-.25*s);
  const g=ctx2.createRadialGradient(0,0,0,0,0,s);
  g.addColorStop(0,'rgba(255,190,220,.95)'); g.addColorStop(1,'rgba(255,90,160,0)');
  ctx2.fillStyle=g; ctx2.fill(); ctx2.restore();
}
let lastTap=0;
addEventListener('click', (e)=>{ const now=performance.now(); if(now-lastTap<320) spawnHearts(e.clientX,e.clientY,20); lastTap=now; }, {passive:true});
addEventListener('touchend', (e)=>{ const now=performance.now(); const t=e.changedTouches&&e.changedTouches[0]; if(now-lastTap<320&&t) spawnHearts(t.clientX,t.clientY,20); lastTap=now; }, {passive:true});

function loopFx(){
  ctx2.clearRect(0,0,fx.width,fx.height);
  for(let i=hearts.length-1;i>=0;i--){ const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy-=0.02; h.life-=0.015;
    ctx2.globalAlpha=Math.max(0,h.life); drawHeart(h.x,h.y,h.size); ctx2.globalAlpha=1; if(h.life<=0) hearts.splice(i,1);
  }
  requestAnimationFrame(loopFx);
} loopFx();

} catch(e) { showError('Error cargando la galaxia: '+e.message); console.error(e); }
})();
</script>


</body></html>
